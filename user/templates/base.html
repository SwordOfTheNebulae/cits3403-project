<!DOCTYPE html>
{% load static %}
{% load grav_tag %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Movie Recommendation System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content=""/>
    <meta name="keywords" content=""/>
    <link rel="icon" href="{% static 'images/new_images/Favicon.png' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/animate.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/animate.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/fontello.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/fontello-codes.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/thumbs-embedded.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/responsive.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/new_css/color.css' %}">
    {% block extra_css %}{% endblock %}
</head>
<body>
<div class="wrapper hp_1">

    <div class="top_bar">
        <div class="container">
            <div class="top_header_content">
                <div class="menu_logo">
                    <a href="#" title="" class="menu">
                        <i class="icon-menu"></i>
                    </a>
                </div><!--menu_logo end-->
                <div class="search_form">
                    <form method="post" action="{% url 'search' %}" id="search">
                        {% csrf_token %}
                        <input type="text" name="search" placeholder="Enter keywords (movie title, actor, director, etc.)">
                        <button type="submit">
                            <i class="icon-search"></i>
                        </button>
                    </form>
                </div><!--search_form end-->
                <ul class="controls-lv">
                    <li class="user-log">
                        <div class="user-ac-img">
                            {% if request.session.login_in == True %}
                            <img src="{{ user.email|gravatar:"60" }}" alt="">
                                {% else %}
                                <img src="{% static 'images/new_images/resources/user-img.png' %}" alt="">
                            {% endif %}
                        </div>
                        <div class="account-menu">
                            {% if request.session.login_in == True %}
                                <h4>{{ request.session.name }}</h4>
                            {% endif %}

                            <div class="sd_menu">
                                <ul class="mm_menu">
                                    {% if request.session.login_in == True %}
                                        <li>
												<span>
													<i class="icon-user"></i>
												</span>
                                            <a href="{% url 'personal' %}" title="">Profile</a>
                                        </li>
                                        <li>
												<span>
													<i class="icon-logout"></i>
												</span>
                                            <a href="{% url 'logout' %}" title="">Logout</a>
                                            {% else %}
                                        <li>
												<span>
													<i class="icon-paid_sub"></i>
												</span>
                                            <a href="{% url 'register' %}" title="">Register</a>
                                        </li>
                                        <li>
												<span>
													<i class="icon-settings"></i>
												</span>
                                            <a href="{% url 'login' %}" title="">Login</a>
                                        </li>
                                    {% endif %}

                                </ul>
                            </div><!--sd_menu end-->
                        </div>
                    </li>
                </ul><!--controls-lv end-->
                <div class="clearfix"></div>
            </div><!--top_header_content end-->
        </div>
    </div><!--header_content end-->

    <div class="side_menu">
        <div class="sd_menu">
            <ul class="mm_menu">
                <li>
						<span>
							<i class="icon-home"></i>
						</span>
                    <a href="{% url 'index' %}" title="">Home</a>
                    {% if request.path == '/' %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-purchased"></i>
						</span>
                    <a href="{% url 'latest_movie' %}" title="">Latest Movies</a>
                    {% if '/latest_movie/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-fire"></i>
						</span>
                    <a href="{% url 'hot_movie' %}" title="">Popular Movies</a>
                    {% if '/hot_movie/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-subscriptions"></i>
						</span>
                    <a href="{% url 'most_view' %}" title="">Most Viewed</a>
                    {% if '/most_view/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-play_list"></i>
						</span>
                    <a href="{% url 'most_mark' %}" title="">Highly Rated</a>
                    {% if '/most_mark/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-flag"></i>
						</span>
                    <a href="{% url 'all_tags' %}" title="">Movie Tags</a>
                    {% if '/all_tags/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-graphics_01"></i>
						</span>
                    <a href="{% url 'analytics_dashboard' %}" title="">Analytics</a>
                    {% if '/analytics/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
            </ul>
        </div><!--sd_menu end-->
        <div class="sd_menu">
            <h3>My Account</h3>
            <ul class="mm_menu">
                <li>
						<span>
							<i class="icon-history"></i>
						</span>
                    <a href="{% url 'my_rate' %}" title="">My Ratings</a>
                    {% if '/my_rate/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-watch_later"></i>
						</span>
                    <a href="{% url 'my_comments' %}" title="">My Comments</a>
                    {% if '/my_comments/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-like"></i>
						</span>
                    <a href="{% url 'mycollect' %}" title="">My Collection</a>
                    {% if '/mycollect/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-add_to_playlist"></i>
						</span>
                    <a href="{% url 'upload_movie_csv' %}" title="">My Movie Data</a>
                    {% if '/upload_movie_csv/' in request.path or '/add_movie_manual/' in request.path or '/movie_upload_list/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-share"></i>
						</span>
                    <a href="{% url 'view_my_shares' %}" title="">My Shared Recommendations</a>
                    {% if '/my_shares/' in request.path or '/create_share/' in request.path or '/edit_share/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-message"></i>
						</span>
                    <a href="{% url 'shared_with_me' %}" title="">Recommendations Shared With Me</a>
                    {% if '/shared_with_me/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
            </ul>
        </div>
        <div class="sd_menu">
            <h3>Recommendations</h3>
            <ul class="mm_menu">
                <li>
						<span>
							<i class="icon-calender"></i>
						</span>
                    <a href="{% url 'user_recommend_view' %}" title="">User-Based Recommendation</a>
                    {% if '/user_recommend_view/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>
                <li>
						<span>
							<i class="icon-notification"></i>
						</span>
                    <a href="{% url 'item_recommend_view' %}" title="">Item-Based Recommendation</a>
                    {% if '/item_recommend_view/' in request.path %}
                    <i class="icon-tick"></i>
                    {% endif %}
                </li>

            </ul>
        </div><!--sd_menu end-->


        <div class="dd_menu"></div>
    </div>

    {% block main_content %}
    {% block content %}{% endblock %}
    {% endblock %}

    <script src="{% static 'js/new_js/jquery.min.js' %}"></script>
    <script src="{% static 'js/new_js/popper.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    <script src="{% static 'js/new_js/flatpickr.js' %}"></script>
    <script src="{% static 'js/new_js/script.js' %}"></script>
    {% block bottom-js %}
    {% endblock %}
    <script>
        // 移除之前的菜单激活脚本

        function get_user_recommend() {
            $.ajax({
                url: '/user_recommend/',
                type: 'GET',
                success: function (result) {
                    var html = "";
                    var array_length = result.length;
                    for (var i = 0; i < array_length; i++) {
                        html += `<div class="col-lg-3 col-md-6 col-sm-6 col-6 full_wdth">\n` +
                            `<div class="videoo">\n<div class="vid_thumbainl">\n` +
                            `<a href="/movie/${result[i].id}" title="">\n` +
                            `<img style="height: 340px; overflow: hidden" src="${result[i].image_link}" alt=""><\a>\n` +
                            `</div>\n<div class="video_info">\n<h3><a href="/movie/${result[i].id}" title="">${result[i].name}</a></h3>\n` +
                            `<h4><a title="">Tags: ${result[i].tags}</a> <span class="verify_ic"></span></h4>\n` +
                            `<span>${result[i].collect_count} Likes<small class="posted_dt">Release Date: ${result[i].years}</small></span>\n` +
                            `</div></div></div>\n`

                        ;
                    }
                    $('#user-recommend').html(html);
                    // console.log(html);
                },
                fail: function (xhr, textStatus, errorThrown) {
                    alert('request failed');
                },
                error: function (jqXHR, exception) {
                    console.log(jqXHR.status);
                    console.log(exception);
                }
            });
        }

        get_user_recommend();

        function get_latest_movie() {
            $.ajax({
                url: '/latest_movie/',
                type: 'GET',
                success: function (result) {
                    var html = "";
                    var array_length = result.length;
                    for (var i = 0; i < array_length; i++) {
                        html += `<li><a href="/movie/${result[i].id}">${result[i].name}</a><span><img src="/static/images/hot.png"/></span></li>`;
                    }
                    $('#latest-movie').html(html);
                },
                fail: function (xhr, textStatus, errorThrown) {
                    alert('request failed');
                },
                error: function (jqXHR, exception) {
                    console.log(jqXHR.status);
                    console.log(exception);
                }
            });
        }

        get_latest_movie();
    </script>
</body>
</html>