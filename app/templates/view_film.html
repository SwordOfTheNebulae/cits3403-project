<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<title>{{ movie.title }}</title>
		<meta name="viewport" content="width=device-width, initial-scale=1" />
	</head>
	<body>
		<header>
			<nav>
				Sitename
				<a href="{{ url_for('home') }}">Home</a>
				<a href="{{ url_for('movies') }}">Movies</a>
				<a href="{{ url_for('reviews') }}">Reviews</a>
				<a href="{{ url_for('data') }}">Visualise</a>

				<span class="right_align">
					{% if current_user.is_authenticated %}
					<a href="{{ url_for('profile', username=current_user.username) }}">
						<img
							alt="user icon"
							src="{{ url_for('static', filename='images/person_24dp_E3E3E3_FILL0_wght400_GRAD0_opsz24.svg') }}"
						/>
						{{ current_user.username }}
					</a>
					{% else %}
					<a href="{{ url_for('login') }}"><img alt="user icon" />Login</a>
					{% endif %}
				</span>
			</nav>
		</header>

		<main>
			<section>
				<h1>{{ movie.title }}</h1>
				<p><strong>Genre:</strong> {{ movie.genre }}</p>
				<p><strong>Year:</strong> {{ movie.year }}</p>
				<p><strong>Average Rating:</strong> {{ movie.avg_rating }}/5</p>
			</section>

			<section>
				<h2>Submit a Review</h2>
				{% if current_user.is_authenticated %}
				<form action="{{ url_for('submit_review', movie_id=movie.id) }}" method="POST">
					<label for="rating">Rating (1â€“5):</label>
					<input type="number" id="rating" name="rating" min="1" max="5" required />

					<label for="review">Review:</label><br />
					<textarea id="review" name="review" rows="4" cols="50" required></textarea><br />

					<button type="submit">Submit</button>
				</form>
				{% else %}
				<p><a href="{{ url_for('login') }}">Log in</a> to submit a review.</p>
				{% endif %}
			</section>

			<section>
				<h2>Reviews</h2>
				{% if reviews %}
					<ul>
						{% for review in reviews %}
							<li>
								<p><strong>{{ review.user.username }}</strong> rated it {{ review.rating }}/5</p>
								<p>{{ review.text }}</p>
							</li>
						{% endfor %}
					</ul>
				{% else %}
					<p>No reviews yet for this movie.</p>
				{% endif %}
			</section>
		</main>

		{% with messages = get_flashed_messages() %}
		{% if messages %}
		<ul>
			{% for message in messages %}
			<li>{{ message }}</li>
			{% endfor %}
		</ul>
		{% endif %}
		{% endwith %}

		<footer>
			(c) sitename 2025 <br />
			<a href="{{ url_for('about') }}">About us</a>
			<a href="https://twitter.com/non-existant-twitter-account-for-our-site">Twitter</a>
		</footer>
	</body>
</html>
